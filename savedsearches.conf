[corelight_thg_bloodhound_ad_discovery]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_dce_rpc" (operation="NetrSessionEnum" OR operation="NetrWkstaUserEnum" OR operation="SamrGetMembersInAlias" OR operation="SamrOpenDomain" OR operation="SamrConnect5" OR operation="SamrCloseHandle")) | eventstats dc(operation) as val by id.orig_h | search val > 5 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,endpoint,operation,uid
[corelight_thg_c2_dga_detected_via_repetitive_failures]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_dns" (rcode_name="NXDOMAIN" OR rcode_name="SERVFAIL" OR rcode_name="nxdomain" OR rcode_name="servfail")) | eventstats dc(query) as val by id.orig_h | search val > 25 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,proto,qtype_name,qtype,query,answers,rcode,rcode_name,trans_id,qtype,ttl,AA,uid
[corelight_thg_client_sending_large_amount_of_data]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_conn" orig_bytes<1000000000 resp_bytes>100000000) | table id.orig_h,id.orig_p,id.resp_h,id.resp_p,orig_bytes,resp_bytes,service,duration,orig_pkts,orig_ip_bytes,resp_pkts,resp_ip_bytes
[corelight_thg_client_transferring_large_amount_of_data_over_http]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_http" request_body_len="0" request_body_len>10000000) | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,host,method,user_agent,status_code,status_msg,uri,referrer,request_body_len,response_body_len,orig_mime_types,resp_mime_types,proxied,origin,orig_fuids,resp_fuids,uid
[corelight_thg_common_port_with_unusual_service]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_conn" id.orig_p<1024 (service="http" OR service="ssl" OR service="rdp" OR service="ssh") local_orig="true" local_resp="false")
[corelight_thg_custom_cryptographic_inference_determined_by_corelight]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_notice" note="Viz::CustomCrypto") | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,proto,p,src,dst,actions,msg,note,fuid,uid
[corelight_thg_domain_user_enumeration_network_recon_01]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_dce_rpc" (operation="LsarLookupNames3" OR operation="LsarLookupSids3" OR operation="SamrGetGroupsForUser" OR operation="SamrLookupIdsInDomain" OR operation="SamrLookupNamesInDomain" OR operation="SamrQuerySecurityObject" OR operation="SamrQueryInformationGroup")) | eventstats dc(operation) as val by id.orig_h | search val > 6 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,endpoint,named_pipe,operation,uid
[corelight_thg_executable_download_directly_from_ip]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_http" ((sourcetype="corelight_http" (host="*1" OR host="*2" OR host="*3" OR host="*4" OR host="*5" OR host="*6" OR host="*7" OR host="*8" OR host="*9" OR host="*0") (host="*.*")) OR (host="*:*" (uri="*.apm" OR uri="*.app" OR uri="*.appref-ms" OR uri="*.bas" OR uri="*.bat" OR uri="*.chi" OR uri="*.chm" OR uri="*.chq" OR uri="*.chw" OR uri="*.dll" OR uri="*.exe" OR uri="*.gadget" OR uri="*.hta" OR uri="*.inf" OR uri="*.jar" OR uri="*.jnlp" OR uri="*.jse" OR uri="*.lnk" OR uri="*.mde" OR uri="*.mht" OR uri="*.msi" OR uri="*.msix" OR uri="*.msixbundle" OR uri="*.pif" OR uri="*.pkg" OR uri="*.pl" OR uri="*.ps1" OR uri="*.ps1xml" OR uri="*.ps2" OR uri="*.ps2xml" OR uri="*.psc1" OR uri="*.psc2" OR uri="*.psd1" OR uri="*.psd1" OR uri="*.psdm1" OR uri="*.psm1" OR uri="*.py" OR uri="*.pyc" OR uri="*.pyo" OR uri="*.pyw" OR uri="*.pyz" OR uri="*.reg" OR uri="*.scr" OR uri="*.sct" OR uri="*.vbe" OR uri="*.vbs" OR uri="*.ws" OR uri="*.wsb" OR uri="*.wsc" OR uri="*.wsf" OR uri="*.xpi" OR uri="*.xz" OR uri="*.z" OR uri="*.zip" OR uri="*.zipx")))) | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,host,method,user_agent,status_code,uri,referrer,request_body_len,response_body_len,orig_mime_types,resp_mime_types,proxied,origin,orig_fuids,resp_fuids,uid
[corelight_thg_executable_from_webdav]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_http" (user_agent="*WebDAV*" OR uri="*webdav*") (resp_mime_types="*dosexec*" OR uri="*.exe")) | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,host,method,version,user_agent,status_code,status_msg,uri,referrer,request_body_len,response_body_len,orig_mime_types,resp_mime_types,proxied,origin,orig_fuids,resp_fuids,uid
[corelight_thg_external_facing_ics_dnp3]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_dnp3" fc_request="*" NOT ((sourcetype="corelight_dnp3" ((id.orig_h="10.*" OR id.orig_h="192.168.*" OR id.orig_h="172.16.*" OR id.orig_h="172.17.*" OR id.orig_h="172.18.*" OR id.orig_h="172.19.*" OR id.orig_h="172.20.*" OR id.orig_h="172.21.*" OR id.orig_h="172.22.*" OR id.orig_h="172.23.*" OR id.orig_h="172.24.*" OR id.orig_h="172.25.*" OR id.orig_h="172.26.*" OR id.orig_h="172.27.*" OR id.orig_h="172.28.*" OR id.orig_h="172.29.*" OR id.orig_h="172.30.*" OR id.orig_h="172.31.*" OR id.orig_h="127.*" OR id.orig_h="169.254.*") OR id.orig_h="::1" OR (id.orig_h="fe80::*" OR id.orig_h="fc00::*")))))
[corelight_thg_external_facing_service_using_rfc_1918_subnets]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_conn" (id.resp_p="*" history="Sh*") NOT ((sourcetype="corelight_conn" ((id.orig_h="10.*" OR id.orig_h="192.168.*" OR id.orig_h="172.16.*" OR id.orig_h="172.17.*" OR id.orig_h="172.18.*" OR id.orig_h="172.19.*" OR id.orig_h="172.20.*" OR id.orig_h="172.21.*" OR id.orig_h="172.22.*" OR id.orig_h="172.23.*" OR id.orig_h="172.24.*" OR id.orig_h="172.25.*" OR id.orig_h="172.26.*" OR id.orig_h="172.27.*" OR id.orig_h="172.28.*" OR id.orig_h="172.29.*" OR id.orig_h="172.30.*" OR id.orig_h="172.31.*" OR id.orig_h="127.*" OR id.orig_h="169.254.*") OR id.orig_h="::1" OR (id.orig_h="fe80::*" OR id.orig_h="fc00::*")))))
[corelight_thg_external_proxy_detected_overview_query]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_http" proxied="*" NOT ((sourcetype="corelight_http" ((id.orig_h="10.*" OR id.orig_h="192.168.*" OR id.orig_h="172.16.*" OR id.orig_h="172.17.*" OR id.orig_h="172.18.*" OR id.orig_h="172.19.*" OR id.orig_h="172.20.*" OR id.orig_h="172.21.*" OR id.orig_h="172.22.*" OR id.orig_h="172.23.*" OR id.orig_h="172.24.*" OR id.orig_h="172.25.*" OR id.orig_h="172.26.*" OR id.orig_h="172.27.*" OR id.orig_h="172.28.*" OR id.orig_h="172.29.*" OR id.orig_h="172.30.*" OR id.orig_h="172.31.*" OR id.orig_h="127.*" OR id.orig_h="169.254.*") OR id.orig_h="::1" OR (id.orig_h="fe80::*" OR id.orig_h="fc00::*"))))) | table host,id.orig_h,id.resp_h,proxied
[corelight_thg_external_socks_proxy]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_conn" service="*socks*" history="Sh*" local_orig="true" local_resp="false")
[corelight_thg_http_traffic_with_no_http_host_set_or_user_agent_set]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_http" client_header_names="USER-AGENT" (NOT (client_header_names="HOST") OR client_header_names="HOST")) | table id.orig_h,id.orig_p,id.resp_h,id.resp_p,uri,referrer,user_agent,request_body_len,response_body_len,status_code,uid
[corelight_thg_internal_and_uncommon_http_service_with_interesting_user_agent_and_mime_type_combination]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_http" ((resp_mime_types="application/java-archive" OR resp_mime_types="application/mshelp" OR resp_mime_types="application/chrome-ext" OR resp_mime_types="application/x-object" OR resp_mime_types="application/x-executable" OR resp_mime_types="application/x-sharedlib" OR resp_mime_types="application/x-mach-o-executable" OR resp_mime_types="application/x-dosexec" OR resp_mime_types="application/x-java-applet" OR resp_mime_types="application/x-java-jnlp-file" OR resp_mime_types="text/x-php" OR resp_mime_types="text/x-perl" OR resp_mime_types="text/x-ruby" OR resp_mime_types="text/x-python" OR resp_mime_types="text/x-awk" OR resp_mime_types="text/x-tcl" OR resp_mime_types="text/x-lua" OR resp_mime_types="text/x-msdos-batch") (user_agent="*certutil*" OR user_agent="*powershell*" OR user_agent="*microsoft*" OR user_agent="*python*" OR user_agent="*libwww-perl*" OR user_agent="*go-http*" OR user_agent="*java/*" OR user_agent="*lua-resty-http*" OR user_agent="*winhttp*" OR user_agent="*vb project*" OR user_agent="*ruby*")) NOT ((id.orig_p="80" OR id.orig_p="8000" OR id.orig_p="8080" OR id.orig_p="8888")) ((id.resp_h="10.*" OR id.resp_h="192.168.*" OR id.resp_h="172.16.*" OR id.resp_h="172.17.*" OR id.resp_h="172.18.*" OR id.resp_h="172.19.*" OR id.resp_h="172.20.*" OR id.resp_h="172.21.*" OR id.resp_h="172.22.*" OR id.resp_h="172.23.*" OR id.resp_h="172.24.*" OR id.resp_h="172.25.*" OR id.resp_h="172.26.*" OR id.resp_h="172.27.*" OR id.resp_h="172.28.*" OR id.resp_h="172.29.*" OR id.resp_h="172.30.*" OR id.resp_h="172.31.*" OR id.resp_h="127.*" OR id.resp_h="169.254.*") OR id.resp_h="::1" OR (id.resp_h="fe80::*" OR id.resp_h="fc00::*")))
[corelight_thg_lnk_file_download_or_usage_over_http]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_http" (method="GET" (uri="*.lnk" OR uri="*.LNK" OR uri="*.inf" OR uri="*.INF")) NOT (referrer="*"))
[corelight_thg_lnk_file_download_or_usage_over_smb_overview_query]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_smb_files" (name="*.lnk" OR name="*.LNK" OR name="*.inf" OR name="*.INF"))
[corelight_thg_multiple_abnormal_non_conforming_http_requests]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_weird" name="bad_HTTP_request") | eventstats dc(id.orig_h) as val by id.resp_p | search val > 10 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,name,notice,addl,conn,id,uid
[corelight_thg_multiple_clients_to_http_using_unicode_host_via_httppossible_multiple_phishing_attempts]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_http" ((method="POST" OR method="PUT") NOT (referrer="*")) NOT (uri="/") host="*xn--*") | eventstats dc(uri) as val by id.orig_h | search val > 10
[corelight_thg_multiple_compressed_files_transferred_outbound]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_files" NOT (total_bytes="0") (mime_type="application/vnd.ms-cab-compressed" OR mime_type="application/warc" OR mime_type="application/x-7z-compressed" OR mime_type="application/x-ace" OR mime_type="application/x-arc" OR mime_type="application/x-archive" OR mime_type="application/x-arj" OR mime_type="application/x-compress" OR mime_type="application/x-cpio" OR mime_type="application/x-dmg" OR mime_type="application/x-eet" OR mime_type="application/x-gzip" OR mime_type="application/x-lha" OR mime_type="application/x-lrzip" OR mime_type="application/x-lz4" OR mime_type="application/x-lzma" OR mime_type="application/x-lzh" OR mime_type="application/x-lzip" OR mime_type="application/x-rar" OR mime_type="application/x-rpm" OR mime_type="application/x-stuffit" OR mime_type="application/x-tar" OR mime_type="application/x-xz" OR mime_type="application/x-zoo" OR mime_type="application/zip")) | eventstats dc(sha1) as val by tx_hosts | search val > 25 | table filename,mime_type,extracted,total_bytes,sha1,md5,sha256,rx_hosts,local_orig,is_orig,tx_hosts
[corelight_thg_multiple_compressed_files_transferred_over_http]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_http" ((method="POST" OR method="PUT") (mime_type="application/vnd.ms-cab-compressed" OR mime_type="application/warc" OR mime_type="application/x-7z-compressed" OR mime_type="application/x-ace" OR mime_type="application/x-arc" OR mime_type="application/x-archive" OR mime_type="application/x-arj" OR mime_type="application/x-compress" OR mime_type="application/x-cpio" OR mime_type="application/x-dmg" OR mime_type="application/x-eet" OR mime_type="application/x-gzip" OR mime_type="application/x-lha" OR mime_type="application/x-lrzip" OR mime_type="application/x-lz4" OR mime_type="application/x-lzma" OR mime_type="application/x-lzh" OR mime_type="application/x-lzip" OR mime_type="application/x-rar" OR mime_type="application/x-rpm" OR mime_type="application/x-stuffit" OR mime_type="application/x-tar" OR mime_type="application/x-xz" OR mime_type="application/x-zoo" OR mime_type="application/zip")) NOT (referrer="*")) | eventstats dc(uri) as val by id.orig_h | search val > 25 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,host,method,user_agent,status_code,uri,referrer,request_body_len,response_body_len,orig_mime_types,resp_mime_types,proxied,origin,orig_fuids,resp_fuids,uid
[corelight_thg_multiple_files_sent_over_http_with_abnormal_requests]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_http" (mime_type="application/vnd.ms-cab-compressed" OR mime_type="application/warc" OR mime_type="application/x-7z-compressed" OR mime_type="application/x-ace" OR mime_type="application/x-arc" OR mime_type="application/x-archive" OR mime_type="application/x-arj" OR mime_type="application/x-compress" OR mime_type="application/x-cpio" OR mime_type="application/x-dmg" OR mime_type="application/x-eet" OR mime_type="application/x-gzip" OR mime_type="application/x-lha" OR mime_type="application/x-lrzip" OR mime_type="application/x-lz4" OR mime_type="application/x-lzma" OR mime_type="application/x-lzh" OR mime_type="application/x-lzip" OR mime_type="application/x-rar" OR mime_type="application/x-rpm" OR mime_type="application/x-stuffit" OR mime_type="application/x-tar" OR mime_type="application/x-xz" OR mime_type="application/x-zoo" OR mime_type="application/zip") NOT (referrer="*") request_body_len>10000000) | eventstats dc(uid) as val by id.orig_h | search val > 10 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,host,method,user_agent,status_code,status_msg,uri,referrer,request_body_len,response_body_len,orig_mime_types,resp_mime_types,proxied,origin,orig_fuids,resp_fuids,uid
[corelight_thg_multiple_kerberos_tickets_used_from_single_client]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_kerberos" successful="true" request_type="TGS" client="*" till="*") | eventstats dc(client) as val by id.orig_h | search val > 5 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,request_type,client_cert_subject,service,server_cert_subject,renewable,auth_ticket,from,till
[corelight_thg_multiple_remote_smb_connections_from_single_client]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_smb_mapping" path="*" share_name="*") | eventstats dc(share_name) as val by id.orig_h | search val > 20 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,native_file_system,path,service,share_type,uid
[corelight_thg_multiple_ssh_brute_inferences_from_single_ip]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_ssh" inference="BFS Client Brute Force") | eventstats dc(id.resp_h) as val by id.orig_h | search val > 3
[corelight_thg_multiple_windows_admin_share_connections]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_smb_mapping" path="*ADMIN$") | eventstats dc(id.resp_h) as val by id.orig_h | search val > 3 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,native_file_system,path,service,share_type,uid
[corelight_thg_multiple_windows_remote_registry_service_connections]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_dce_rpc" endpoint="winreg") | eventstats dc(id.resp_h) as val by id.orig_h | search val > 10 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,endpoint,named_pipe,operation,uid
[corelight_thg_network_service_scanning_multiple_ips]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_conn" (local_orig="true" local_resp="true" (conn_state="S0" OR conn_state="REJ")) NOT (history="*D*")) | eventstats dc(id.resp_p) as val by id.orig_h | search val > 25 | table id.orig_h,id,id.orig_p,id.resp_h,id.resp_p,conn_state,history,orig_pkts,resp_pkts,orig_bytes,resp_bytes,service
[corelight_thg_network_service_scanning_multiple_ips_for_open_port]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_conn" (local_orig="true" local_resp="true" (conn_state="S0" OR conn_state="REJ")) NOT (history="*D*")) | eventstats dc(id.resp_p) as val by id.orig_h | search val > 10 | table id.orig_h,id.orig_p,id.resp_h,id.resp_p,conn_state,history,orig_pkts,resp_pkts,orig_bytes,resp_bytes,service
[corelight_thg_network_share_discovery]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_dce_rpc" (endpoint="srvsvc" OR (operation="NetshareEnumAll" OR operation="NetShareEnum"))) | eventstats dc(id.resp_h) as val by id.orig_h | search val > 3 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,endpoint,named_pipe,operation,uid
[corelight_thg_possible_data_collection_over_smb]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_smb_files" name="*" NOT (name="<share_root>")) | eventstats dc(name) as val by id.orig_h | search val > 50 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,name,path,prev_name,size,times_accessed,times_changed,times_created,times_modified,fuid,uid
[corelight_thg_possible_data_collection_related_to_office_docs_and_email_archives_and_pdfs]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_smb_files" name="*" NOT (name="<share_root>") (name="*.doc" OR name="*.xls" OR name="*.ost" OR name="*.pst" OR name="*.pst1" OR name="*.pdf" OR name="*.vss" OR name="*.viz")) | eventstats dc(name) as val by id.orig_h | search val > 30 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,path,prev_name,name,size,times_accessed,times_changed,times_created,times_modified,fuid,uid
[corelight_thg_possible_kerberos_brute_force_attempt]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_kerberos" client="*") | eventstats dc(id.orig_h) as val by id.resp_h | search val > 100 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,request_type,cipher,client,client_cert_subject,service,server_cert_subject,renewable,auth_ticket,from,till,success,error_code,error_msg,uid
[corelight_thg_possible_typo_squatting_or_punycode_phishing_http_request]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_http" method="GET" NOT (referrer="*") host="*xn--*") | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,host,method,user_agent,status_code,uri,referrer,request_body_len,response_body_len,orig_mime_types,resp_mime_types,proxied,origin,orig_fuids,resp_fuids,uid
[corelight_thg_possible_webshelldirty_word_list]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_http" NOT (status_code="4*") ((uri="*pwned*" OR uri="*owned*" OR uri="*backdoor*" OR uri="*spy*" OR uri="*bypass*" OR uri="*root*" OR uri="*r00t*" OR uri="*p0wn*" OR uri="*robots*" OR uri="*hidden*" OR uri="*shell*" OR uri="*cunt*" OR uri="*nigg*" OR uri="*shit*" OR uri="*crap*" OR uri="*fuck*" OR uri="*bitch*" OR uri="*telnet*" OR uri="*hidden*" OR uri="*predator*" OR uri="*safe_mode*" OR uri="*cfexec*" OR uri="*botp*" OR uri="*zer0*" OR uri="*mysql_*" OR uri="*oracle_*" OR uri="*perlbot*") (uri="*.aspx" OR uri="*.asp" OR uri="*.php" OR uri="*.jsp" OR uri="*.jspx" OR uri="*.war" OR uri="*.ashx" OR uri="*.asmx" OR uri="*.ascx" OR uri="*.asx" OR uri="*.cshtml" OR uri="*.cfm" OR uri="*.cfc" OR uri="*.cfml" OR uri="*.wss" OR uri="*.do" OR uri="*.action" OR uri="*.pl" OR uri="*.plx" OR uri="*.pm" OR uri="*.xs" OR uri="*.t" OR uri="*.pod" OR uri="*.php-s" OR uri="*.pht" OR uri="*.phar" OR uri="*.phps" OR uri="*.php7" OR uri="*.php5" OR uri="*.php4" OR uri="*.php3" OR uri="*.phtml" OR uri="*.py" OR uri="*.rb" OR uri="*.rhtml" OR uri="*.cgi" OR uri="*.dll" OR uri="*.ayws" OR uri="*.cgi" OR uri="*.erb" OR uri="*.rjs" OR uri="*.hta" OR uri="*.htc" OR uri="*.cs" OR uri="*.kt" OR uri="*.lua" OR uri="*.vbhtml") (method="POST" OR method="PUT"))) | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,host,method,user_agent,status_code,uri,referrer,request_body_len,response_body_len,orig_mime_types,resp_mime_types,proxied,origin,orig_fuids,resp_fuids,uid
[corelight_thg_possible_webshellrare_put_or_post_by_ip]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_http" ((uri="*.aspx" OR uri="*.asp" OR uri="*.php" OR uri="*.jsp" OR uri="*.jspx" OR uri="*.war" OR uri="*.ashx" OR uri="*.asmx" OR uri="*.ascx" OR uri="*.asx" OR uri="*.cshtml" OR uri="*.cfm" OR uri="*.cfc" OR uri="*.cfml" OR uri="*.wss" OR uri="*.do" OR uri="*.action" OR uri="*.pl" OR uri="*.plx" OR uri="*.pm" OR uri="*.xs" OR uri="*.t" OR uri="*.pod" OR uri="*.php-s" OR uri="*.pht" OR uri="*.phar" OR uri="*.phps" OR uri="*.php7" OR uri="*.php5" OR uri="*.php4" OR uri="*.php3" OR uri="*.phtml" OR uri="*.py" OR uri="*.rb" OR uri="*.rhtml" OR uri="*.cgi" OR uri="*.dll" OR uri="*.ayws" OR uri="*.cgi" OR uri="*.erb" OR uri="*.rjs" OR uri="*.hta" OR uri="*.htc" OR uri="*.cs" OR uri="*.kt" OR uri="*.lua" OR uri="*.vbhtml") (method="POST" OR method="PUT")) NOT (status_code="4*")) | eventstats dc(id.orig_h) as val by uri | search val < 3 | table uri,host,user_agent,id.orig_h,id.resp_h,id.orig_p,id.resp_p,referrer
[corelight_thg_possible_webshell_put_or_post_to_unusual_extensions]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_http" ((uri="*.jpg" OR uri="*.jpeg" OR uri="*.gif" OR uri="*.png" OR uri="*.icon" OR uri="*.ico" OR uri="*.xml" OR uri="*.swf" OR uri="*.svg" OR uri="*.ppt" OR uri="*.pttx" OR uri="*.doc" OR uri="*.docx" OR uri="*.rtf" OR uri="*.pdf" OR uri="*.tif" OR uri="*.zip" OR uri="*.mov") (method="POST" OR method="PUT") status_code="2*") NOT ((request_body_len="0") OR (response_body_len="0"))) | table uri,host,user_agent,id.orig_h,id.resp_h,id.resp_p,id.orig_p,referrer
[corelight_thg_possible_windows_executable_download_without_matching_mime_type]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_http" (resp_mime_types="application/java-archive" OR resp_mime_types="application/mshelp" OR resp_mime_types="application/chrome-ext" OR resp_mime_types="application/x-object" OR resp_mime_types="application/x-executable" OR resp_mime_types="application/x-dosexec" OR resp_mime_types="application/x-msdownload" OR resp_mime_types="application/vnd.microsoft.portable-executable ") NOT ((uri="*.exe" OR uri="*.dll" OR uri="*.msi"))) | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,host,method,user_agent,status_code,uri,referrer,request_body_len,response_body_len,orig_mime_types,resp_mime_types,proxied,origin,orig_fuids,resp_fuids,uid
[corelight_thg_potentially_harmful_attachment]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_files" id.orig_h="SMTP" (name="*.7z" OR name="*.ace" OR name="*.apm" OR name="*.app" OR name="*.appref-ms" OR name="*.arj" OR name="*.asp" OR name="*.bas" OR name="*.bat" OR name="*.bz2" OR name="*.bzip2" OR name="*.cab" OR name="*.cdxml" OR name="*.cer" OR name="*.chi" OR name="*.chm" OR name="*.chq" OR name="*.chw" OR name="*.class" OR name="*.cmd" OR name="*.cnt" OR name="*.com" OR name="*.cpl" OR name="*.crt" OR name="*.doc" OR name="*.docm" OR name="*.epub" OR name="*.exe" OR name="*.gadget" OR name="*.gz" OR name="*.gzip" OR name="*.hta" OR name="*.img" OR name="*.inf" OR name="*.ins" OR name="*.ins" OR name="*.iso" OR name="*.isp" OR name="*.isp" OR name="*.jar" OR name="*.jar" OR name="*.jnlp" OR name="*.jse" OR name="*.lnk" OR name="*.lzh" OR name="*.mde" OR name="*.mht" OR name="*.msi" OR name="*.msix" OR name="*.msixbundle" OR name="*.ods" OR name="*.odt" OR name="*.pif" OR name="*.pkg" OR name="*.pl" OR name="*.ps1" OR name="*.ps1xml" OR name="*.ps2" OR name="*.ps2xml" OR name="*.psc1" OR name="*.psc2" OR name="*.psd1" OR name="*.psd1" OR name="*.psdm1" OR name="*.psm1" OR name="*.pssc" OR name="*.py" OR name="*.pyc" OR name="*.pyo" OR name="*.pyw" OR name="*.pyz" OR name="*.pyzw" OR name="*.r01" OR name="*.r14" OR name="*.r18" OR name="*.r25" OR name="*.rar" OR name="*.reg" OR name="*.scr" OR name="*.sct" OR name="*.shb" OR name="*.sys" OR name="*.tar" OR name="*.taz" OR name="*.tbz" OR name="*.tbz2" OR name="*.tgz" OR name="*.txz" OR name="*.udl" OR name="*.vbe" OR name="*.vbs" OR name="*.ws" OR name="*.wsb" OR name="*.wsc" OR name="*.wsf" OR name="*.xbap" OR name="*.xls" OR name="*.xlsm" OR name="*.xpi" OR name="*.xz" OR name="*.z" OR name="*.zipx"))
[corelight_thg_potentially_interesting_user_agent_and_mime_type_combination]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_http" (resp_mime_types="application/java-archive" OR resp_mime_types="application/mshelp" OR resp_mime_types="application/chrome-ext" OR resp_mime_types="application/x-object" OR resp_mime_types="application/x-executable" OR resp_mime_types="application/x-sharedlib" OR resp_mime_types="application/x-mach-o-executable" OR resp_mime_types="application/x-dosexec" OR resp_mime_types="application/x-java-applet" OR resp_mime_types="application/x-java-jnlp-file" OR resp_mime_types="text/x-php" OR resp_mime_types="text/x-perl" OR resp_mime_types="text/x-ruby" OR resp_mime_types="text/x-python" OR resp_mime_types="text/x-awk" OR resp_mime_types="text/x-tcl" OR resp_mime_types="text/x-lua" OR resp_mime_types="text/x-msdos-batch") (user_agent="*certutil*" OR user_agent="*powershell*" OR user_agent="*microsoft*" OR user_agent="*python*" OR user_agent="*libwww-perl*" OR user_agent="*go-http*" OR user_agent="*java/*" OR user_agent="*lua-resty-http*" OR user_agent="*winhttp*" OR user_agent="*vb project*" OR user_agent="*ruby*") ((id.orig_h="10.*" OR id.orig_h="192.168.*" OR id.orig_h="172.16.*" OR id.orig_h="172.17.*" OR id.orig_h="172.18.*" OR id.orig_h="172.19.*" OR id.orig_h="172.20.*" OR id.orig_h="172.21.*" OR id.orig_h="172.22.*" OR id.orig_h="172.23.*" OR id.orig_h="172.24.*" OR id.orig_h="172.25.*" OR id.orig_h="172.26.*" OR id.orig_h="172.27.*" OR id.orig_h="172.28.*" OR id.orig_h="172.29.*" OR id.orig_h="172.30.*" OR id.orig_h="172.31.*" OR id.orig_h="127.*" OR id.orig_h="169.254.*") OR id.orig_h="::1" OR (id.orig_h="fe80::*" OR id.orig_h="fc00::*")))
[corelight_thg_potential_forced_external_outbound_dce_rpc]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_conn" service="dce*" history="Sh*" local_orig="true" local_resp="false") | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,proto,community_id,duration,conn_state,history,orig_pkts,resp_pkts,orig_bytes,resp_bytes,service,orig_ip_bytes,resp_ip_bytes,local_orig,local_resp,uid
[corelight_thg_potential_forced_external_outbound_gssapi]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_conn" service="gssapi*" history="Sh*" local_orig="true" local_resp="false") | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,proto,community_id,duration,conn_state,history,orig_pkts,resp_pkts,orig_bytes,resp_bytes,service,orig_ip_bytes,resp_ip_bytes,local_orig,local_resp,uid
[corelight_thg_potential_forced_external_outbound_kerberos]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_conn" service="krb*" history="Sh*" local_orig="true" local_resp="false") | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,proto,community_id,duration,conn_state,history,orig_pkts,resp_pkts,orig_bytes,resp_bytes,service,orig_ip_bytes,resp_ip_bytes,local_orig,local_resp,uid
[corelight_thg_potential_forced_external_outbound_ntlm]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_conn" service="ntlm" history="Sh*" local_orig="true" local_resp="false") | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,proto,community_id,duration,conn_state,history,orig_pkts,resp_pkts,orig_bytes,resp_bytes,service,orig_ip_bytes,resp_ip_bytes,local_orig,local_resp,uid
[corelight_thg_potential_forced_external_outbound_smb]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_conn" service="smb*" history="Sh*" local_orig="true" local_resp="false") | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,proto,community_id,duration,conn_state,history,orig_pkts,resp_pkts,orig_bytes,resp_bytes,service,orig_ip_bytes,resp_ip_bytes,local_orig,local_resp,uid
[corelight_thg_potential_forced_llmnr_lookup]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_dns" (id.resp_p="5355" answers="*" query="*.*") NOT ((sourcetype="corelight_dns" ((id.resp_h="10.*" OR id.resp_h="192.168.*" OR id.resp_h="172.16.*" OR id.resp_h="172.17.*" OR id.resp_h="172.18.*" OR id.resp_h="172.19.*" OR id.resp_h="172.20.*" OR id.resp_h="172.21.*" OR id.resp_h="172.22.*" OR id.resp_h="172.23.*" OR id.resp_h="172.24.*" OR id.resp_h="172.25.*" OR id.resp_h="172.26.*" OR id.resp_h="172.27.*" OR id.resp_h="172.28.*" OR id.resp_h="172.29.*" OR id.resp_h="172.30.*" OR id.resp_h="172.31.*" OR id.resp_h="127.*" OR id.resp_h="169.254.*") OR id.resp_h="::1" OR (id.resp_h="fe80::*" OR id.resp_h="fc00::*"))))) | eventstats dc(query) as val by id.orig_h | search val > 2 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,proto,qtype_name,qtype,query,answers,rcode,rcode_name,trans_id,qtype,ttl,AA,uid
[corelight_thg_potential_forced_netbios_dns_lookup]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_dns" ((id.resp_p="137" OR id.resp_p="138") answers="*" query="*.*") NOT ((sourcetype="corelight_dns" ((id.resp_h="10.*" OR id.resp_h="192.168.*" OR id.resp_h="172.16.*" OR id.resp_h="172.17.*" OR id.resp_h="172.18.*" OR id.resp_h="172.19.*" OR id.resp_h="172.20.*" OR id.resp_h="172.21.*" OR id.resp_h="172.22.*" OR id.resp_h="172.23.*" OR id.resp_h="172.24.*" OR id.resp_h="172.25.*" OR id.resp_h="172.26.*" OR id.resp_h="172.27.*" OR id.resp_h="172.28.*" OR id.resp_h="172.29.*" OR id.resp_h="172.30.*" OR id.resp_h="172.31.*" OR id.resp_h="127.*" OR id.resp_h="169.254.*") OR id.resp_h="::1" OR (id.resp_h="fe80::*" OR id.resp_h="fc00::*"))))) | eventstats dc(query) as val by id.orig_h | search val > 2 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,proto,qtype_name,qtype,query,answers,rcode,rcode_name,trans_id,qtype,ttl,AA,uid
[corelight_thg_potential_webdav_forced_authentication]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_http" user_agent="*webdav*" NOT ((sourcetype="corelight_http" ((id.resp_h="10.*" OR id.resp_h="192.168.*" OR id.resp_h="172.16.*" OR id.resp_h="172.17.*" OR id.resp_h="172.18.*" OR id.resp_h="172.19.*" OR id.resp_h="172.20.*" OR id.resp_h="172.21.*" OR id.resp_h="172.22.*" OR id.resp_h="172.23.*" OR id.resp_h="172.24.*" OR id.resp_h="172.25.*" OR id.resp_h="172.26.*" OR id.resp_h="172.27.*" OR id.resp_h="172.28.*" OR id.resp_h="172.29.*" OR id.resp_h="172.30.*" OR id.resp_h="172.31.*" OR id.resp_h="127.*" OR id.resp_h="169.254.*") OR id.resp_h="::1" OR (id.resp_h="fe80::*" OR id.resp_h="fc00::*")))))
[corelight_thg_psexec_over_smb_detected]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_smb_files" name="PSEXESVC*") | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,name,path,prev_name,size,times_accessed,times_changed,times_created,times_modified,fuid,uid
[corelight_thg_rdp_dashboard_overview_query]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_rdp" id.orig_h="*") | table id.orig_h,id.resp_h,id.resp_p,cookie,keyboard_layout
[corelight_thg_rdp_possible_non_user_login_abnormal_screen_resolution]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_rdp" desktop_height<600 desktop_width<600) | table id.orig_h,id.resp_h,id.resp_p,cookie,keyboard_layout
[corelight_thg_rdp_scanning_potential_brute_force_common_user_names]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_rdp" (cookie="Root" OR cookie="root" OR cookie="Administr" OR cookie="administr" OR cookie="Admin" OR cookie="admin" OR cookie="Guest" OR cookie="guest" OR cookie="Info" OR cookie="info" OR cookie="Test" OR cookie="test" OR cookie="Adm" OR cookie="adm" OR cookie="User" OR cookie="user" OR cookie="DA" OR cookie="da" OR cookie="Local" OR cookie="local" OR cookie="Letmein" OR cookie="letmein" OR cookie="Service" OR cookie="service" OR cookie="." OR cookie="Computer" OR cookie="computer" OR cookie="xxx" OR cookie="/" OR cookie="\\")) | eventstats dc(cookie) as val by id.orig_h | search val > 3 | table id.orig_h,id.resp_p,id.resp_h,cookie,result,security_protocol,ssl,encryption_method,encryption_level,client_name,client_build,desktop_width,keyboard_layout,cert_type
[corelight_thg_rdp_suspicious_keyboard_layout]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_rdp" ((keyboard_layout="*Arabic*" OR keyboard_layout="Armenian - Armenia" OR keyboard_layout="Farsi" OR keyboard_layout="Pashto" OR keyboard_layout="Swahili" OR keyboard_layout="Syriac") OR (keyboard_layout="Chinese *" OR keyboard_layout="Mongolian (Mongolian)" OR keyboard_layout="Mongolian *" OR keyboard_layout="Tibetan *" OR keyboard_layout="Uighur - China") OR (keyboard_layout="Assamese" OR keyboard_layout="Kannada" OR keyboard_layout="* India" OR keyboard_layout="Sanskrit" OR keyboard_layout="Telugu") OR keyboard_layout="Korean" OR (keyboard_layout="* Nigeria" OR keyboard_layout="Wolof" OR keyboard_layout="Yoruba") OR (keyboard_layout="Catalan" OR keyboard_layout="Rhaeto-Romanic") OR (keyboard_layout="Albanian - Albania" OR keyboard_layout="*Cyrillic*" OR keyboard_layout="FYRO Macedonian" OR keyboard_layout="Russian *" OR keyboard_layout="Sorbian" OR keyboard_layout="Uzbek (Cyrillic)" OR keyboard_layout="Uzbek (Latin)" OR keyboard_layout="Yakut" OR keyboard_layout="Serbian *" OR keyboard_layout="Slovak" OR keyboard_layout="Slovenian") OR keyboard_layout="Vietnamese"))
[corelight_thg_remote_creation_of_temp_file_in_system32_folder]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_smb_files" name="*SYSTEM32\\*.tmp*" NOT (action="SMB::FILE_OPEN")) | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,name,path,prev_name,size,times_accessed,times_changed,times_created,times_modified,fuid,uid
[corelight_thg_response_from_external_facing_service_overview_query]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_conn" local_orig="false" local_resp="true" id.orig_h="*" history="Sh*") | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,proto,community_id,duration,conn_state,history,orig_pkts,resp_pkts,orig_bytes,resp_bytes,service,orig_ip_bytes,resp_ip_bytes,local_orig,local_resp,uid
[corelight_thg_schedule_task_access_or_manipulation_over_smb]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_smb_files" (path="*\\*\\SYSVOL*" name="*ScheduledTasks.xml") NOT (action="SMB::FILE_OPEN")) | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,name,path,prev_name,size,times_accessed,times_changed,times_created,times_modified,fuid,uid
[corelight_thg_self_signed_tls_ssl_certificate_overview_query]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_ssl" validation_status="self signed certificate") | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,client_issuer,client_subject,ja3,ja3s,issuer,subject,established,cipher,version,uid
[corelight_thg_sensitive_file_access_on_admin_network_share]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_smb_files" path="*ADMIN$*" (name="*\\mimidrv*" OR name="*\\lsass*" OR name="*\\windows\\minidump\\*" OR name="*\\hiberfil*" OR name="*\\sqldmpr*" OR name="*\\sam*" OR name="*\\ntds.dit*" OR name="*\\security*"))
[corelight_thg_sensitive_file_access_over_smb_share]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_smb_files" (name="*.rsa" OR name="*.pem" OR name="*.dsa" OR name="*.dit" OR name="*.ecdsa" OR name="*.ocsp" OR name="*.ed25519" OR name="*.p12" OR name="*.pfx" OR name="*.kdbx" OR name="*keychain" OR name="*keystore" OR name="*keyring" OR name="*pass.txt" OR name="*password.txt" OR name="*passwords.txt" OR name="*.bek" OR name="*passwd" OR name="*shadow" OR name="*salesforce.js" OR name="*.psafe3" OR name="*credentials.xml" OR name="*localsettings.php" OR name="*.mimi" OR name="*.dmp" OR name="*.dump" OR name="*hiberfil.sys" OR name="*1.txt" OR name="*.kirbi" OR name="*.ost" OR name="*.pst" OR name="*groups.xml" OR name="*.bak" OR name="*.ovpn" OR name="*.sqlite" OR name="*.sqlite3" OR name="*.sqldump"))
[corelight_thg_smb_single_file_created_then_deleted_successively]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_smb_files" name="*" NOT (name="<share_root>")) | eventstats dc(times_modified) as val by name | search val > 5 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,name,path,prev_name,size,times_accessed,times_changed,times_created,times_modified,fuid,uid
[corelight_thg_smtp_email_containing_non_ascii_characters_within_the_subject]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_smtp" subject="\\=?utf-16*")
[corelight_thg_ssh_inference_abnormal_client_activity]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_ssh" logged_ssh_inference="ABP") | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,client,server,version,logged_ssh_inference,kex_alg,mac_alg,cipher_alg,compression_alg,hassh,hasshServer,host_key,host_key_alg,uid
[corelight_thg_suspicious_dns_z_flag_bit_set]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_dns" (NOT (Z="0") query="*.*") NOT ((sourcetype="corelight_dns" ((query="*.arpa" OR query="*.local" OR query="*.ultradns.net" OR query="*.twtrdns.net" OR query="*.azuredns-prd.info" OR query="*.azure-dns.com" OR query="*.azuredns-ff.info" OR query="*.azuredns-ff.org" OR query="*.azuregov-dns.org") OR (qtype_name="NS" OR qtype_name="ns") OR answers="*\\x00" OR (id.resp_p="137" OR id.resp_p="138" OR id.resp_p="139"))))) | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,proto,qtype_name,qtype,query,answers,rcode,rcode_name,trans_id,qtype,ttl,AA,uid
[corelight_thg_uncommon_external_facing_application_service]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_conn" (service="dce_rpc" OR service="dnp3" OR service="gssapi" OR service="krb_tcp" OR service="krb_udp" OR service="krb" OR service="modbus" OR service="ntlm" OR service="radius" OR service="rdp" OR service="rdpeudp" OR service="rpc" OR service="smb" OR service="snmp" OR service="syslog") history="Sh*" local_orig="false" local_resp="true")
[corelight_thg_windows_sysvol_file_modification]
search = (`corelight_idx` sensor_name IN ($selected_sensor$) sourcetype="corelight_smb_files" (path="*Sysvol" OR path="*SYSVOL" OR path="*sysvol") NOT (action="SMB::FILE_OPEN")) | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,name,path,prev_name,size,times_accessed,times_changed,times_created,times_modified,fuid,uid
